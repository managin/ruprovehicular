<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Planilla Control Diario Vehicular</title>
  <style>
    :root{--bg:#ffffff;--muted:#6b7280;--accent:#0b74de;--border:#e5e7eb;--card:#f9fafb}
    body{font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; background:var(--bg); color:#0f172a; margin:18px}
    .container{max-width:900px;margin:0 auto;display:none;}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    h1{font-size:18px;margin:0}
    .small{font-size:13px;color:var(--muted)}
    .card{background:var(--card);border:1px solid var(--border);border-radius:8px;padding:12px;margin-bottom:14px;box-shadow:0 1px 0 rgba(15,23,42,0.02)}
    input, select, textarea{width:100%;padding:8px;border:1px solid var(--border);border-radius:6px;font-size:14px}
    textarea{min-height:70px}
    .grid{display:grid;grid-template-columns:1fr 220px;gap:12px}
    .toolbar{display:flex;gap:8px;justify-content:flex-end;margin-bottom:10px}
    .btn{background:var(--accent);color:#fff;border:none;padding:8px 12px;border-radius:6px;cursor:pointer}
    .btn.secondary{background:#eef2ff;color:#0b3a80}
    .btn.ghost{background:transparent;border:1px solid var(--border);color:#0f172a}
    .gauge{width:220px;height:120px;display:flex;align-items:center;justify-content:center}
    svg .needle{transform-origin:50% 88%;transition:transform 1s ease-in-out}
    .gauge-legend{font-size:12px;color:var(--muted);text-align:center;margin-top:6px}

    /* login */
    #loginBox{display:flex;flex-direction:column;align-items:center;justify-content:center;height:90vh;text-align:center}
    #loginBox input{width:200px;margin:6px 0}
    #loginBox button{margin-top:8px;background:var(--accent);color:#fff;border:none;padding:8px 14px;border-radius:6px;cursor:pointer}
  </style>
</head>
<body>
  <!-- login -->
  <div id="loginBox">
    <h2>Acceso restringido</h2>
    <p class="small">Ingrese usuario y contraseña</p>
    <input type="text" id="user" placeholder="Usuario">
    <input type="password" id="pass" placeholder="Contraseña">
    <button id="loginBtn">Ingresar</button>
    <p id="msg" class="small" style="color:#c53030;margin-top:8px"></p>
  </div>

  <!-- contenido principal -->
  <div class="container" id="main">
    <header>
      <div>
        <h1>Planilla Control Diario Vehicular</h1>
        <div class="small">Completar y presionar "Agregar otro" si necesitás más registros</div>
      </div>
    </header>

    <div class="toolbar">
      <button class="btn secondary" id="addBtn">Agregar otro</button>
      <button class="btn ghost" id="resetBtn">Reset</button>
      <button class="btn" id="exportPdf">Exportar PDF</button>
    </div>

    <form id="forms">
      <template id="tpl">
        <section class="card record">
          <div style="display:flex;justify-content:space-between;gap:10px;align-items:flex-start">
            <div style="flex:1">
              <div class="grid">
                <div>
                  <label>Fecha</label>
                  <input type="date" name="fecha">
                </div>
                <div>
                  <label>Patente</label>
                  <input type="text" name="patente" placeholder="ABC123">
                </div>
              </div>

              <div style="margin-top:8px">
                <label>Limpieza</label><br>
                <label><input type="radio" name="limpieza"> Sí</label>
                <label><input type="radio" name="limpieza"> No</label>
              </div>

              <div style="margin-top:8px" class="grid">
                <div>
                  <label>Aceite</label>
                  <select name="aceite"><option>OK</option><option>Revisar</option></select>
                </div>
                <div>
                  <label>Agua</label>
                  <select name="agua"><option>OK</option><option>Revisar</option></select>
                </div>
              </div>

              <div style="margin-top:8px" class="grid">
                <div>
                  <label>Km recibido</label>
                  <input type="number" name="km_recibido">
                </div>
                <div>
                  <label>Km entrega</label>
                  <input type="number" name="km_entrega">
                </div>
              </div>

              <div style="margin-top:8px">
                <label>Novedades</label>
                <textarea name="novedades"></textarea>
              </div>

              <div class="small" style="margin-top:8px">Firma Chofer: ________________________</div>
            </div>

            <div style="width:240px;text-align:center">
              <div class="gauge">
                <svg viewBox="0 0 200 110" width="200" height="110">
                  <path d="M10,100 A90,90 0 0,1 190,100" fill="none" stroke="#e6edf5" stroke-width="18" stroke-linecap="round"/>
                  <path d="M20,100 A80,80 0 0,1 180,100" fill="none" stroke="#dbe7fb" stroke-width="10" stroke-linecap="round"/>
                  <g stroke="#9aa7bf" stroke-width="2"></g>
                  <line class="needle" x1="100" y1="100" x2="100" y2="24" stroke="#c53030" stroke-width="3" stroke-linecap="round" transform="rotate(-40 100 100)" />
                  <circle cx="100" cy="100" r="5" fill="#0f172a" />
                </svg>
              </div>

              <div style="margin-top:6px">
                <label class="small">Nivel combustible</label>
                <input type="range" min="0" max="100" value="50" class="fuel-range" style="width:100%">
                <div class="gauge-legend"><span>E</span><span style="float:right">F</span></div>
              </div>
            </div>
          </div>
          <div style="text-align:right;margin-top:8px">
            <button type="button" class="btn ghost remove">Eliminar</button>
          </div>
        </section>
      </template>

      <div id="list"></div>
    </form>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script>
    // login simple
    document.getElementById('loginBtn').addEventListener('click', function(){
      const user = document.getElementById('user').value.trim();
      const pass = document.getElementById('pass').value.trim();
      if(user === 'admin' && pass === '1234'){
        document.getElementById('loginBox').style.display = 'none';
        document.querySelector('.container').style.display = 'block';
      } else {
        document.getElementById('msg').textContent = 'Credenciales incorrectas';
      }
    });

    function makeTicks(svg){
      var g = document.createElementNS('http://www.w3.org/2000/svg','g');
      g.setAttribute('stroke','#9aa7bf'); g.setAttribute('stroke-width','2');
      for(var i=0;i<=12;i++){
        var a=-90+(i/12)*180,rOut=80,rIn=(i%3===0)?60:68;
        var x1=100+rOut*Math.cos(a*Math.PI/180),y1=100+rOut*Math.sin(a*Math.PI/180);
        var x2=100+rIn*Math.cos(a*Math.PI/180),y2=100+rIn*Math.sin(a*Math.PI/180);
        var line=document.createElementNS('http://www.w3.org/2000/svg','line');
        line.setAttribute('x1',x1);line.setAttribute('y1',y1);line.setAttribute('x2',x2);line.setAttribute('y2',y2);
        g.appendChild(line);
      }
      svg.appendChild(g);
    }

    function attachGauge(section){
      var svg = section.querySelector('svg');
      if(svg && !svg.dataset.ticks){ makeTicks(svg); svg.dataset.ticks = '1'; }
      var range = section.querySelector('.fuel-range');
      var needle = section.querySelector('.needle');
      function setVal(v){
        var angle = -90 + (v/100)*180;
        needle.style.transform = 'rotate('+angle+'deg)';
      }
      range.addEventListener('input', function(){ setVal(this.value); });
      setVal(range.value);
    }

    var tpl=document.getElementById('tpl'),list=document.getElementById('list'),counter=0;
    function addRecord(){
      counter++;
      var node=tpl.content.cloneNode(true);
      var sect=node.querySelector('.record');
      sect.querySelectorAll('[name]').forEach(el=>{
        var n=el.getAttribute('name');
        el.setAttribute('name', n+'_'+counter);
      });
      list.appendChild(node);
      var last=list.lastElementChild;
      attachGauge(last);
      last.querySelector('.remove').addEventListener('click',()=>last.remove());
      return last;
    }

    document.getElementById('addBtn').addEventListener('click',()=>addRecord());
    addRecord();
    document.getElementById('resetBtn').addEventListener('click',()=>{list.innerHTML='';counter=0;addRecord();});

    document.getElementById('exportPdf').addEventListener('click',function(){
      var opt={margin:0.4,filename:'planilla_control_vehicular.pdf',image:{type:'jpeg',quality:0.98},
        html2canvas:{scale:2,useCORS:true},jsPDF:{unit:'in',format:'a4',orientation:'portrait'}};
      document.querySelector('.toolbar').style.visibility='hidden';
      html2pdf().set(opt).from(document.querySelector('.container')).save().then(()=>{document.querySelector('.toolbar').style.visibility='visible';});
    });
  </script>
</body>
</html>
